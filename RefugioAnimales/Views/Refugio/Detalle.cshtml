@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@model RefugioAnimales.Models.Animal

@{
    ViewData["Title"] = Model.Nombre;
    var usuarioLogueado = HttpContextAccessor.HttpContext?.Session.GetString("UsuarioId") != null;
}

<style>
    .detail-card {
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-top: 20px;
    }

    .detail-header h1 {
        margin-top: 0;
        font-size: 2.2em;
        color: #2d3748;
    }

    .detail-content {
        display: grid;
        grid-template-columns: 1fr 1.2fr; /* Imagen un poco más pequeña que el texto */
        gap: 40px;
        margin-top: 20px;
    }

    .detail-image {
        width: 100%;
        height: auto;
        max-height: 400px;
        object-fit: cover;
        border-radius: 8px;
        background-color: #eee;
    }

    .info-row {
        margin-bottom: 15px;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
    }

    .info-label {
        font-weight: 600;
        color: #718096;
        font-size: 0.9em;
        display: block;
    }

    .info-value {
        color: #2d3748;
        font-size: 1.1em;
    }

    .estado-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-weight: bold;
        display: inline-block;
    }

    .actions-bar {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #eee;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    /* Botones */
    .btn-action {
        padding: 10px 20px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 500;
        border: none;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 5px;
    }

    .btn-edit {
        background-color: #4a5568;
        color: white;
    }

        .btn-edit:hover {
            background-color: #2d3748;
        }

    .btn-adopt {
        background-color: #48bb78;
        color: white;
    }

        .btn-adopt:hover {
            background-color: #38a169;
        }

    .btn-cancel {
        background-color: #f56565;
        color: white;
    }

        .btn-cancel:hover {
            background-color: #e53e3e;
        }

    .btn-back {
        background-color: #e2e8f0;
        color: #4a5568;
    }

        .btn-back:hover {
            background-color: #cbd5e0;
        }

    .adopt-info {
        background-color: #f0fff4;
        color: #276749;
        padding: 10px 15px;
        border-radius: 6px;
        border: 1px solid #c6f6d5;
    }

    @@media (max-width: 768px) {
        .detail-content

    {
        grid-template-columns: 1fr;
        gap: 20px;
    }

    }
</style>

<a asp-action="Animales" class="btn-action btn-back" style="margin-bottom: 10px;">← Volver al listado</a>

<div class="detail-card">
    <div class="detail-header">
        <h1>@Model.Nombre</h1>
    </div>

    <div class="detail-content">
        <div>
            <img src="@Url.Action("ObtenerImagen", "Refugio", new { id = Model.Id })"
                 alt="@Model.Nombre"
                 class="detail-image"
                 onerror="this.src='https://via.placeholder.com/500x400?text=Sin+Imagen'">
        </div>

        <div>
            <div class="info-row">
                <span class="info-label">Especie</span>
                <span class="info-value">@Model.Especie</span>
            </div>
            <div class="info-row">
                <span class="info-label">Edad</span>
                <span class="info-value">@Model.Edad años</span>
            </div>
            <div class="info-row">
                <span class="info-label">Estado Actual</span>
                <div style="margin-top: 5px;">
                    @if (Model.Estado == "Disponible")
                    {
                        <span class="estado-badge" style="background:#c6f6d5; color:#22543d;">Disponible</span>
                    }
                    else if (Model.Estado == "Adoptado")
                    {

                        <span class="estado-badge" style="background:#feebc8; color:#744210;">Adoptado</span>
                    }
                    else
                    {

                        <span class="estado-badge" style="background:#fed7d7; color:#742a2a;">@Model.Estado</span>
                    }
                </div>
            </div>
            <div class="info-row" style="border-bottom: none;">
                <span class="info-label">Descripción</span>
                <p class="info-value" style="margin-top:5px; line-height: 1.6;">@Model.Descripcion</p>
            </div>

            <div class="actions-bar">
                @if (usuarioLogueado)
                {
                    <a asp-action="Editar" asp-route-id="@Model.Id" class="btn-action btn-edit">✏️ Editar</a>
                }

                @if (Model.Estado != "Adoptado")
                {
                    @if (usuarioLogueado)
                    {
                        <a asp-action="Adoptar" asp-route-id="@Model.Id" class="btn-action btn-adopt">❤️ Adoptar</a>
                    }
                }
                else
                {
                    <div class="adopt-info">
                        <strong>¡Adoptado!</strong> por @Model.Adoptante?.Nombre <br />
                        <small>Fecha: @Model.FechaAdopcion?.ToShortDateString()</small>
                    </div>

                    @if (usuarioLogueado)
                    {
                        <form asp-action="Desadoptar" asp-route-id="@Model.Id" method="post" onsubmit="return confirm('¿Cancelar adopción?');" style="display:inline;">
                            <button type="submit" class="btn-action btn-cancel">Cancelar Adopción</button>
                        </form>
                    }
                }
            </div>
        </div>
    </div>
</div>